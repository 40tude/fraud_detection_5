# Concurrency Requirements Checklist: Concurrent Pipeline

**Purpose**: Validate requirements quality for concurrent execution, shutdown behavior, and buffer contract -- "unit tests for English"
**Created**: 2026-02-23
**Feature**: [spec.md](../spec.md) | [plan.md](../plan.md)

---

## Requirement Completeness

- [ ] CHK001 - Are requirements defined for what constitutes "simultaneous" operation in FR-001 -- specifically whether both tasks must be schedulable within the same event loop tick, or only within the same wall-clock window? [Completeness, Spec §FR-001]
- [ ] CHK002 - Is "indefinitely" in FR-002 defined with an explicit termination condition -- is it unambiguous that only CTRL+C or buffer closure can stop the loop? [Completeness, Spec §FR-002]
- [ ] CHK003 - Are requirements specified for the case where `tokio::signal::ctrl_c()` registration fails (e.g., signal support unavailable on a target platform)? [Gap]
- [ ] CHK004 - Is the `ConcurrentBuffer` contract (write/read/close behaviors) formally specified as requirements -- or only implicitly defined by code snippets in plan.md? [Completeness, Plan §ConcurrentBuffer Contract]
- [ ] CHK005 - Are requirements defined for what "finishes its current operation" means in US2-AC2 -- specifically whether an in-flight `write_batch` must be fully acknowledged before Producer stops? [Completeness, Spec §US2-AC2]
- [ ] CHK006 - Are FR-009 log message formats (text content) specified -- or only the log level (`info`) and rough intent? [Completeness, Spec §FR-009, Clarifications]
- [ ] CHK007 - Are requirements defined for buffer capacity limits -- is there a maximum buffer size before Producer must yield or block? [Gap, NFR]

---

## Requirement Clarity

- [ ] CHK008 - Is "interleave in real time" in SC-001 defined with an observable, unambiguous criterion -- or does it introduce subjective judgment into acceptance? [Ambiguity, Spec §SC-001]
- [ ] CHK009 - Is "clean stop" defined consistently across US1-AC3, US2-AC1, and the Assumptions section -- specifically does it always mean exit code 0 + no panic + no hang? [Clarity, Spec §Assumptions]
- [ ] CHK010 - Is "no transactions left unprocessed" in US3-AC2 qualified -- does it cover only transactions that entered Buffer1 before close, or all transactions generated by Producer? [Clarity, Spec §US3-AC2]
- [ ] CHK011 - Is "no data loss risk" in the edge case section a formal specification commitment or an informal annotation -- and if a commitment, is it captured as a numbered requirement? [Ambiguity, Spec §Edge Cases]
- [ ] CHK012 - Is the `yield_now()` retry loop in the `read_batch` contract bounded -- are requirements defined for what happens if Producer never writes and Consumer loops indefinitely? [Clarity, Plan §ConcurrentBuffer Contract]

---

## Requirement Consistency

- [ ] CHK013 - Is FR-004 (close Buffer1 on CTRL+C) consistent with FR-005 (producer-task wrapper closes Buffer1 on finite completion) -- do both paths produce the same observable shutdown sequence? [Consistency, Spec §FR-004, §FR-005]
- [ ] CHK014 - Is the Logger exclusion in Assumptions consistently reflected across all FR and SC items -- are there any requirements that implicitly assume Logger is running? [Consistency, Spec §Assumptions]
- [ ] CHK015 - Is US3-AC3 ("all 55 tests continue to pass") consistent with FR-008 -- or does US3-AC3 add a constraint (no test modification) that FR-008 does not explicitly state? [Consistency, Spec §FR-008, §US3-AC3]

---

## Acceptance Criteria Quality

- [ ] CHK016 - Is SC-001 (interleaving verified by manual observation only) a formally acceptable success criterion -- is the trade-off vs. automated verification explicitly acknowledged and justified? [Measurability, Spec §SC-001, Clarifications]
- [ ] CHK017 - Is the 5-second shutdown window in US2-AC3 enforceable without an automated timeout mechanism -- is it clear how a violation would be detected in practice? [Measurability, Spec §US2-AC3, Clarifications]
- [ ] CHK018 - Does SC-003 ("55 tests pass") provide sufficient regression coverage for the concurrent refactoring -- or are additional acceptance criteria needed to validate the concurrency behavior itself? [Completeness, Spec §SC-003]

---

## Scenario Coverage

- [ ] CHK019 - Are requirements specified beyond the edge case note for the simultaneous-signal scenario (iteration limit and CTRL+C fire at the same time) -- is the expected outcome formally captured? [Coverage, Spec §Edge Cases]
- [ ] CHK020 - Are requirements defined for the case where `tokio::join!` resolves with one task error and one success -- is partial failure handled consistently with the `p.context()?; c.context()?` pattern in plan.md? [Coverage, Plan §Phase C]
- [ ] CHK021 - Are recovery requirements defined for a producer or consumer panic -- is it specified whether a panic should propagate, be caught, or trigger shutdown? [Gap, Exception Flow]
- [ ] CHK022 - Are requirements specified for the behavior when Consumer is significantly slower than Producer -- is buffer growth or backpressure in scope or explicitly excluded? [Coverage, Gap]

---

## Non-Functional Requirements

- [ ] CHK023 - Are startup requirements defined -- is there a maximum acceptable latency between app launch and both tasks being schedulable? [Gap, NFR]
- [ ] CHK024 - Is the Windows 11 compatibility of `tokio::signal::ctrl_c()` documented -- are any platform-specific limitations of CTRL+C signal handling captured as requirements or assumptions? [Dependency, Spec §Assumptions]
- [ ] CHK025 - Is the single-thread runtime retention (current_thread) justified against the concurrent model -- is it documented why the multi-thread runtime is explicitly out of scope? [Assumption, Spec §Assumptions]

---

## Notes

- CHK008/CHK016: Manual observation for SC-001 is explicitly clarified but introduces subjectivity -- evaluate whether the justification is sufficient for PR acceptance.
- CHK012: The `yield_now()` loop is an unbounded retry by design; if this is intentional, it should be stated as an explicit assumption in spec.md.
- CHK021: Panic propagation is not addressed anywhere in spec.md or plan.md -- this is a genuine gap worth resolving before implementation.
- Items without `[Spec §...]` reference indicate genuine documentation gaps `[Gap]`.
